package project;

import javax.swing.*;
import javax.swing.border.EmptyBorder;
import java.awt.*;
import java.time.LocalDate;

public class HealthcarePanel extends JPanel {
    private JLabel characterLabel;
    private static JTextField weightField;
    private static JTextField heightField;
    private static JTextField ageField;
    private JButton backBtn;

    private SchedulerApp parent;
    private MainPanel mainPanel;

    public HealthcarePanel(SchedulerApp parent, MainPanel mainPanel) {
        this.parent = parent;
        this.mainPanel = mainPanel;

        setLayout(new BorderLayout(12, 12));
        setBorder(new EmptyBorder(12, 12, 12, 12));

        JPanel top = new JPanel(new GridLayout(1, 3, 10, 10));
        characterLabel = new JLabel("캐릭터: (미등록)", SwingConstants.CENTER);
        characterLabel.setFont(new Font("SansSerif", Font.BOLD, 18));
        top.add(characterLabel);

        weightField = new JTextField();
        weightField.setBorder(BorderFactory.createTitledBorder("몸무게 (kg)"));
        top.add(weightField);

        heightField = new JTextField();
        heightField.setBorder(BorderFactory.createTitledBorder("키 (cm)"));
        top.add(heightField);

        ageField = new JTextField();
        ageField.setBorder(BorderFactory.createTitledBorder("나이 (세)"));
        top.add(ageField);

        add(top, BorderLayout.NORTH);

        JPanel bottom = new JPanel(new FlowLayout(FlowLayout.CENTER, 24, 8));
        backBtn = new JButton("이전");
        bottom.add(backBtn);
        add(bottom, BorderLayout.SOUTH);

        JPanel center = new JPanel(new GridLayout(3, 1, 12, 12));
        JButton exerciseBtn = new JButton("운동 입력");
        JButton calorieBtn = new JButton("칼로리 입력");
        JButton sleepBtn = new JButton("수면 입력");
        center.add(exerciseBtn);
        center.add(calorieBtn);
        center.add(sleepBtn);
        add(center, BorderLayout.CENTER);

        exerciseBtn.addActionListener(e -> new ExerciseInputDialog((JFrame)SwingUtilities.getWindowAncestor(this), mainPanel));
        calorieBtn.addActionListener(e -> new CalorieInputDialog((JFrame)SwingUtilities.getWindowAncestor(this)));
        sleepBtn.addActionListener(e -> new SleepInputDialog((JFrame)SwingUtilities.getWindowAncestor(this)));
    }

    public void setCharacterText(String text) {
        characterLabel.setText("캐릭터: " + text);
    }

    public JButton getBackButton() {
        return backBtn;
    }

    public static double getWeight() {
        try { return Double.parseDouble(weightField.getText()); }
        catch (Exception e) { return 0; }
    }
    public static double getHeight() {
        try { return Double.parseDouble(heightField.getText()); }
        catch (Exception e) { return 0; }
    }
    public static int getAge() {
        try { return Integer.parseInt(ageField.getText()); }
        catch (Exception e) { return 0; }
    }

    // 운동 입력 다이얼로그
    private static class ExerciseInputDialog extends JDialog {
        public ExerciseInputDialog(JFrame parent, MainPanel mainPanel) {
            super(parent, "운동 입력", true);
            setSize(400, 300);
            setLocationRelativeTo(parent);
            setLayout(new BorderLayout(10,10));

            JLabel title = new JLabel("운동 기록", SwingConstants.CENTER);
            title.setFont(new Font("SansSerif", Font.BOLD, 20));
            add(title, BorderLayout.NORTH);

            // 표에 있는 운동들
            String[] exercises = {
                "걷기", "달리기", "줄넘기", "자전거타기", "수영",
                "스쿼트", "팔굽혀펴기", "윗몸일으키기", "등산", "요가",
                "에어로빅", "농구", "축구", "테니스", "배드민턴"
            };
            JComboBox<String> exerciseCombo = new JComboBox<>(exercises);

            JTextField minutesField = new JTextField();
            minutesField.setBorder(BorderFactory.createTitledBorder("운동 시간 (분)"));

            JPanel center = new JPanel(new GridLayout(2,1,10,10));
            center.add(exerciseCombo);
            center.add(minutesField);
            add(center, BorderLayout.CENTER);

            JButton okBtn = new JButton("확인");
            okBtn.addActionListener(e -> {
                try {
                    String exercise = (String) exerciseCombo.getSelectedItem();
                    double minutes = Double.parseDouble(minutesField.getText());
                    double hours = minutes / 60.0;

                    int kcalPerHour = 0;
                    switch (exercise) {
                        case "걷기": kcalPerHour = 300; break;
                        case "달리기": kcalPerHour = 600; break;
                        case "줄넘기": kcalPerHour = 700; break;
                        case "자전거타기": kcalPerHour = 500; break;
                        case "수영": kcalPerHour = 550; break;
                        case "스쿼트": kcalPerHour = 400; break;
                        case "팔굽혀펴기": kcalPerHour = 350; break;
                        case "윗몸일으키기": kcalPerHour = 320; break;
                        case "등산": kcalPerHour = 450; break;
                        case "요가": kcalPerHour = 200; break;
                        case "에어로빅": kcalPerHour = 420; break;
                        case "농구": kcalPerHour = 500; break;
                        case "축구": kcalPerHour = 600; break;
                        case "테니스": kcalPerHour = 450; break;
                        case "배드민턴": kcalPerHour = 400; break;
                    }

                    int kcal = (int)Math.round(kcalPerHour * hours);
                    LocalDate today = LocalDate.now();
                    mainPanel.addExerciseCalories(today, kcal);

                    JOptionPane.showMessageDialog(this,
                        exercise + " " + minutes + "분 → " + kcal + " kcal 소모");
                    dispose();
                } catch (Exception ex) {
                    JOptionPane.showMessageDialog(this, "운동 시간을 올바르게 입력해주세요.");
                }
            });
            add(okBtn, BorderLayout.SOUTH);

            setVisible(true);
        }
    }

    // 칼로리 입력 다이얼로그
    private static class CalorieInputDialog extends JDialog {
        public CalorieInputDialog(JFrame parent) {
            super(parent, "칼로리 입력", true);
            setSize(400, 300);
            setLocationRelativeTo(parent);
            setLayout(new BorderLayout(10,10));

            JLabel title = new JLabel("칼로리 기록", SwingConstants.CENTER);
            title.setFont(new Font("SansSerif", Font.BOLD, 20));
            add(title, BorderLayout.NORTH);

            JTextField kcalField = new JTextField();
            kcalField.setBorder(BorderFactory.createTitledBorder("칼로리 (kcal)"));
            add(kcalField, BorderLayout.CENTER);

            JButton okBtn = new JButton("확인");
            okBtn.addActionListener(e -> {
                JOptionPane.showMessageDialog(this, "칼로리 기록 저장됨: " + kcalField.getText() + " kcal");
                dispose();
            });
            add(okBtn, BorderLayout.SOUTH);

            setVisible(true);
        }
    }

    // 수면 입력 다이얼로그
    private static class SleepInputDialog extends JDialog {
        public SleepInputDialog(JFrame parent) {
            super(parent, "수면 입력", true);
            setSize(400, 300);
            setLocationRelativeTo(parent);
            setLayout(new BorderLayout(10,10));

            JLabel title = new JLabel("수면 기록", SwingConstants.CENTER);
            title.setFont(new Font("SansSerif", Font.BOLD, 20));
            add(title, BorderLayout.NORTH);

            JTextField hourField = new JTextField();
            hourField.setBorder(BorderFactory.createTitledBorder("수면 시간 (시간)"));
            add(hourField, BorderLayout.CENTER);

            JButton okBtn = new JButton("확인");
            okBtn.addActionListener(e -> {
                JOptionPane.showMessageDialog(this, "수면 기록 저장됨: " + hourField.getText() + "시간");
                dispose();
            });
            add(okBtn, BorderLayout.SOUTH);

            setVisible(true);
        }
    }
}